import Discord from 'discord.js';
import { Command } from '../bot';

const Info = {
    name: 'Gamble Modul',
    description: 'Glückspiel Olé',
    author: 'Tillmann Hübner <ruohki@gmail.com>',
    version: '1.0'
}

class Roll extends Command {    
    /**
     * Initalisiert das Plugin
     */
    init() {
        if (!this.Client) throw new Error('Client muss definiert sein');

        let Client = this.Client;
        Client.on('message', this.processMessage);
    }

    destructor() {        
        this.Client.removeListener('message', this.processMessage);    
    }

    /**
     * @param {Discord.Message} message Discord Message
     */
    processMessage(message) {        
        if (message.content.substr(0,1) !== '!') return;

        let command = message.content.split(' ', 2)[0].substr(1);
        let payload = message.content.split(' ', 2).length > 1 ? message.content.split(' ', 2)[1] : '';
        
        switch(command) {
            case 'rnd':
            case 'dice':
            case 'random':
            case 'würfeln':
            case 'roll':                
                let author =  message.guild.member(message.author);

                if (payload.match(/^[0-9]*$/) && (payload !== '')) {
                    let max = parseInt(payload);
                    let number = Math.floor(Math.random() * max) + 1;

                    message.channel.sendMessage(`${author.toString()} hat eine **${number}** gewürfelt [1-${max}] :game_die: `);
                } else if (payload.match(/^[0-9]{1,}\-[0-9]{1,}$/)) {
                    let minmax = payload.split('-');
                                        
                    let min = parseInt(minmax[0]) < parseInt(minmax[1]) ? parseInt(minmax[0]) : parseInt(minmax[1]);
                    let max = parseInt(minmax[1]) > parseInt(minmax[0]) ? parseInt(minmax[1]) : parseInt(minmax[0]);
                    
                    let number = Math.floor(Math.random() * (max - min + 1)) + min;
                    
                    message.channel.sendMessage(`${author.toString()} hat eine **${number}** gewürfelt [${min}-${max}] :game_die: `);
                } else {
                    let number = Math.floor(Math.random() * 100) + 1;
                    message.channel.sendMessage(`${author.toString()} hat eine **${number}** gewürfelt [1-100] :game_die: `);
                }

                break;
        }
    }
}